2021년 4월 25일
핀 번호 정의 거의 완료. 로직 구현은 되어 있지 않음

2021년 5월 1일
- 알고리즘 반영 시작
- 핀번호 전처리 변경사항 있음
- 전역변수 수정/추가
- Stepper 라이브러리 BYJ 모터 선언 추가
- setup 함수 작성 완료(검토 필요)
- ISR 함수 중 호출/목적지 버튼 부분 작성 완료(검토 필요)
- irGetDist 함수 기능 및 명칭 변경 -> getFloor, 층수 구하고 FND로 표시
- 74HC595 쉬프트 레지스터로 FND 구동, shiftOut 함수 사용 결정(확정사항 아님)
- loop 함수에 알고리즘 구현 시작
- 오류 발견: UP과 DN 전처리 부분이 각각 두 번 선언되어 있음. 수정 요

2021년 5월 6일
- 일부 중요한 함수 구현 시작(모터 제어, 이동방향 결정 함수 등)
- BYJ에서 NEMA로 바꿀 수 있다는 것을 감안해 주석화한 코드를 추가함.
- setup 함수 등 일부 함수에 변경사항이 있음.
- 자잘한 오류 수정

2021년 7월 28일
• IR 센서를 모두 디지털로 처리하도록 변경함
• 문짝 구동 모터를 byj에서 네마 모터 처리로 코드를 변경함
• 목적지 확인 함수(chkDest) 일부 작성
• 모터 정밀제어 함수 일부 작성 (디버깅 필요)
• loop 함수 수정
• 전역 변수 수정
• getFloor 함수 수정(층수 표시 구현 안됨)
• 메인 모터 구동 함수에 운전 상태(상향? 하향?) 기록 부분 추가
• 문 구동 함수 작성(미완, 모터 방향을 확인할 필요가 있음)

2021년 7월 30일
• FND 제어 함수를 getFloor 함수에서 사용하도록 함(층수 표시가 가능해짐)
• getFloor 함수가 loop 함수에서 목적지/호출지가 아니면서 카 모터가 구동중인 경우 작동되도록 함
• chkDest 함수에서 목적지/호출지 배열을 조작하도록 하고, 반환값을 지정함
• loop 함수 수정함(carStat 조정 부분 삭제, 로직 수정 등)
• motorDrv 함수에서 isMoving(움직이는가?) 변수를 조작하도록 함.
• 주석문을 수정함
※ 비상 버튼 기능을 아직 구현하지 않았음. 비상 버튼은 인터럽트가 아닌 loop 함수 내에서 구현할 예정.

2021년 8월 3일
• 비상운전을 구현함(디버깅 필요)
• 비상운전 구현을 위해 loop함수 내 제어 코드를 별도의 함수로 분리함.
• 문 제어 함수를 호출하는 코드에 문제가 있어 이를 바로잡음.
• setup 함수에서 잘못된 부분이 있어 이를 바로잡음.
※ 엘리베이터 실물의 모터 구동 방향을 아직 확인하지 않았음. 이는 추후 반영할 것임.

2021년 10월 26일
■ 추가
• 전처리 부분 카 움직임 명령값/상태값 추가(상승-저속복귀운전, 하강-저속복귀운전)
• 74HC595 IC(FND 제어) 핀 번호 정의 추가
• spdStat 전역변수 추가
→ 비상정지 기능 구현을 위해 가속·감속·정속·저속복귀 상태를 기록하는 변수
• motorDrv 함수에 비상정지 후 복귀 운전을 추가

■ 수정
• 주석을 조금 더 알아보기 좋게 수정
• setup 함수 수정(핀 번호 전처리 바뀐 부분을 반영함)
• doorDrv 함수와 setup에서 적외선 센서로 감지하는 대신 일정 스텝각 만큼 돌아가게 바꿈(하드웨어 구성을 반영함)
☆ 소방운전을 비상정지로 바꿈
→ 미완성인 기능 대신 유지보수/디버그 작업에 쓰기 좋은 기능으로 갈음함

■ 삭제
• chkDoor 함수 삭제(문 상태 센서가 없으므로 필요가 없음)
• 사용하지 않는 핀 번호 정의(LEDBn, IR_SNSR_DOOR_ ……)를 삭제하거나 주석처리(하드웨어 구성 반영)
• irStat, isEmergency, isDoorOpen 전역변수 삭제(필요 없음)
• 없어진 핀 번호 정의가 들어간 코드를 모두 지움

■ 해야할 것
※ 비상상황 대처를 위해 시험운전은 모두 랩 파워서플라이 출력을 11.9V로 설정하고 진행하며, 메인 파워서플라이를 쓰지 않는다.
※ 비상상황이 발생하면 바로 랩 파워서플라이의 전압값을 내리거나 전류값을 내려 작동을 멈추고, 카가 천천히 내려오도록 손으로 잡는다.
• 바뀐 doorDrv 함수가 작동하는가?
• 대체적으로 잘 작동하는가?
• 문의 스텝수(190, 1바퀴보다 살짝 덜 돌아감)는 적절한가?
• 비상정지 후 복귀 운전이 잘 되는가?
• 등화류가 모두 잘 작동하는가?
• 배선에 문제는 없는가?

2021년 10월 27일
• 논리 오류나 문법 오류를 고침
☆ 코드 동작 상황을 자세히 알기 위해 디버그 코드를 따로 만듦
!!!!! 하드웨어 배선 테스트 코드를 따로 만들 필요가 있어보임 !!!!!

2021년 10월 29일(1번째 커밋)
■ 28일 프로그램 테스트 결과
• 로직 오류를 전반적으로 고칠 필요가 있음
• 버튼이 눌리면 문 여닫기 무한루프에 빠지는 문제가 있음
• 센서 입력 없이 층수가 무작위로 들어가는 문제가 있음
• 비상정지 램프는 릴레이가 반대로 작동하는 것으로 확인됨.
• 상승/하강 램프가 제대로 동작하지 않아 확인이 필요함.
• 모터가 정상적으로 동작하지 않음.
→ 문 모터가 전혀 움직이지 않음. 배선 문제를 확인하고 로직을 다시 살펴봐야 함
→ 메인 모터의 동작이 굉장히 이상함.
• 2층 상향호출 버튼의 램프 부분 결선에 접촉 불량이 있음
☆ 전반적으로 프로그램을 명령줄 하나 하나 다 읽어가면서 다시 손보고, 필요하면 동작에 중요한 핵심코드는 루프 함수에 병합해 같이 움직이게 하는 쪽으로 가야 함.

■ 프로그램 변경 사항
• strtr 함수와 ctrlmove 함수를 없애고 loop에 통합시켜서 같이 동작하게 함.
• 로직을 전체적으로 손봄.
• 이전 운전방향을 기록하게 하여 로직 오류를 조금 해결함.
• 정지 상태에서 문을 계속 가동하는 로직 오류를 고침.
→ 문을 여닫은 후 호출·목적지 배열의 해당 층수의 항목을 false로 돌리지 않아 생긴 문제
• 직렬 통신 기능을 기본으로 하여서 기본 제어코드와 디버그 코드를 병합함.

2021년 10월 29일(마지막 커밋)
■ 마지막으로 커밋한 프로그램의 테스트 결과
• 모든 등화류가 정상작동함
• 간혹 로직 오류가 나는 경우가 있음. 신호가 전기적 노이즈로 인해 혼입되는 현상(버튼 하나만 눌러도 여러개가 눌림)과, 로직 어느 부분에서 신호를 정상적으로 처리하지 못해서 발생하는 것으로 추정됨.
• 모든 층에서 호출이 잘 됨
• 모든 층을 목적지로 설정하여 움직일 수 있음.
• 간혹 카가 딜레이가 맞지 않아서 바깥문과 제대로 맞물리지 않은 상태로(메인 모터 제어/딜레이 불량) 정지하여 시스템을 다시 시작해야할 수 있음. 이 문제를 해결해야 함.
• 센서 인식용 막대 3개 중 가운데만 남기는 선택도 해봄직함.

■ 프로그램 변경사항
• 로직을 갈아엎음
• 오류를 상당수 고침

2021년 10월 30일(1번째 커밋)
• 자잘한 버그 픽스
• 코드 수정

☆ 상승/하강을 구분하지 않고 정지하는 것으로 확인됨. 이 부분을 구현하기 위해서는 호출, 목적지 배열 상태를 확인하고 originalDir 변수와 연동하는 게 필요해보임.
